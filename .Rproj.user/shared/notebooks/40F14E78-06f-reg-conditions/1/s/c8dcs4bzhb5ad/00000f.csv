"0","#| label: fig-residual-plot"
"0","#| fig-cap: Plot of the residuals against the fitted values for two hypothetical models.  One illustrated what we would expect under a correctly specified mean model; the second is an example of a graphic indicating the mean model is misspecified."
"0","#| fig-alt: Side by side scatter plots of residuals; the second graphic shows a trend in the location across the fitted values."
"0","#| echo: false"
"0",""
"0","set.seed(20220110)"
"0",""
"0","fakedat <- tibble("
"0","  case = rep(c('Mean Model\nCorrectly Specified',"
"0","               'Mean Model\nMisspecified'), each = 100),"
"0","  x = rep(runif(100), times = 2),"
"0","  error = rep(rnorm(100, sd = 0.05), times = 2),"
"0","  mean = case_when("
"0","    case == 'Mean Model\nCorrectly Specified' ~ x,"
"0","    case == 'Mean Model\nMisspecified' ~ (x - 0.5)^2"
"0","  ),"
"0","  y = mean + error"
"0",") |>"
"0","  select(-error, -mean) |>"
"0","  nest(subset = c(x, y)) |>"
"0","  mutate(model = map(subset, ~ lm(y ~ x, data = .x)),"
"0","         diagnostics = map(model, ~ tibble(residuals = .x$residuals, "
"0","                                           fitted = .x$fitted))) |>"
"0","  unnest(cols = diagnostics)"
"0",""
"0","ggplot(data = fakedat,"
"0","       mapping = aes(y = residuals, x = fitted)) +"
"0","  geom_point() +"
"0","  geom_hline(yintercept = 0, color = 'blue', linetype = 2) +"
"0","  labs(y = 'Residuals', "
"0","       x = 'Fitted Values') +"
"0","  facet_wrap(~ case, scales = 'free') +"
"0","  theme_bw() +"
"0","  theme(axis.text = element_blank(),"
"0","        axis.ticks = element_blank())"
